<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp1.ListLivraison"
             BackgroundColor="#F8F9FA">

    <Grid RowDefinitions="Auto,Auto,Auto,*" Padding="0">
        <!-- Header -->
        <Frame Grid.Row="0" 
               BackgroundColor="#63518A" 
               Padding="20,40,20,20" 
               CornerRadius="0"
               HasShadow="True"
               Margin="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>

                <Image Source="menu.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" HorizontalOptions="Center"/>
                <Label Grid.Column="1" Text="Minot'Scan" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" TextColor="White"/>
                <Image Grid.Column="2" Source="user.png" HeightRequest="24" WidthRequest="24" VerticalOptions="Center" HorizontalOptions="Center"/>
            </Grid>
        </Frame>

        <!-- Bouton Nouvelle Livraison -->
        <Button Grid.Row="1"
            Text="+ Nouvelle Livraison"
            BackgroundColor="#63518A"
            TextColor="White"
            FontAttributes="Bold"
            FontSize="16"
            CornerRadius="25"
            HeightRequest="50"
            WidthRequest="280"
            HorizontalOptions="Center"
            Margin="20,30,20,20"
            Clicked="OnAddClicked"/>

        <!-- Titre section -->
        <Label Grid.Row="2"
               Text="Livraisons Précédentes"
               FontSize="20"
               FontAttributes="Bold"
               TextColor="#2C3E50"
               Margin="20,10,20,15"/>

        <!-- Liste des livraisons -->
        <CollectionView Grid.Row="3"
                        ItemsSource="{Binding Livraisons}"
                        Margin="20,0,20,20">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame BackgroundColor="White" CornerRadius="12" HasShadow="True" Padding="15" Margin="0,0,0,15">
                        <StackLayout Spacing="6">
                            <Label Text="{Binding IdLivraison, StringFormat='Livraison #{0}'}" FontSize="16" FontAttributes="Bold" TextColor="#2C3E50"/>
                            <Label Text="{Binding Commande.IdClient, StringFormat='Client : {0}'}" FontSize="13" TextColor="#7F8C8D"/>
                            <Label Text="{Binding DatePrevue, StringFormat='Date prévue : {0:dd/MM/yyyy}'}" FontSize="13" TextColor="#7F8C8D"/>
                            <Label Text="{Binding StatutText}" FontSize="13" TextColor="#63518A"/>
                            <Label Text="{Binding Commande.Produits.Count, StringFormat='Nb produits : {0}'}" FontSize="13" TextColor="#7F8C8D"/>
                            <!-- Affiche le libellé du premier produit si présent -->
                            <Label Text="{Binding Commande.Produits[0].Produit.NomProduit, StringFormat='Produit principal : {0}'}" FontSize="13" TextColor="#7F8C8D"/>
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>